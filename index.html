<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome | Shaya Udoff</title>
  <link rel="stylesheet" href="/style.css">
</head>

<body class="entry-page">

  <!-- WELCOME BOX -->
<div class="entry-container" id="welcomeBox">
  <h1>Welcome to Shaya's Corner of the Internet</h1>
  <p>
      THIS SITE EXISTS TO CURE BOREDOM, TEST IDEAS, AND PRACTICE WEB STUFF.
    <br>
    IF YOU TAKE ANYTHING SERIOUSLY, THAT‚ÄôS ON YOU.
    <br><br>
    By continuing, you agree to the 
    <button class="view-disclaimer-btn" onclick="showDisclaimer(false)">
      terms, privacy, and mildly dramatic tracking notice
    </button>
    <br><br>
  
    Enter at your own risk. üíª
  </p>
</div>

    <button class="enter-site-btn" onclick="showDisclaimer(true)">
      Enter
    </button>
  </div>

  <div class="disclaimer-overlay" id="disclaimerOverlay"></div>
  <!-- DISCLAIMER BOX -->
  <div class="disclaimer-container" id="disclaimerBox">
    <div class="disclaimer-sheet">
      <div class="sheet-handle"></div>

     <h2>Disclaimer (The Necessary Fine Print)</h2>

<p>
  By continuing, you agree to the following. Yes, this part matters.<br>
  This site collects limited usage data to function properly and avoid digital nonsense.<br><br>

  ‚Ä¢ What we may collect (depending on consent and browser/device support):<br>
  Page views, button clicks, timestamps, referrer, and basic device/browser info (user-agent, language).<br>
  Our server may also receive your IP address and approximate location (country/region/city) from the hosting provider.<br>
  Standard internet mechanics. Nothing dramatic. üåê<br><br>

  ‚Ä¢ What I would absolutely love to collect (theoretically):<br>
  Your Wi-Fi name. Your open tabs. Your search history. Your photos. Your contacts. Your camera. Your microphone.<br>
  Unfortunately for my inner supervillain, I do not know how to do that.<br>
  it's too bad I am just not advanced enough... yet...<br>
  And until further notice, we are operating at ‚Äúenthusiastic web developer‚Äù level ‚Äî not ‚Äúcyber overlord.‚Äù<br>
  If someone on the internet is reading this and decides they want to teach me, please do fill out the contact form with your contact info and let's get to work.<br><br>

  ‚Ä¢ Consent by action:<br>
  Pressing Enter means you consent to the collection and processing of technical and usage data as described above.<br>
  Entry is conditional on that consent.<br>
  If you disagree, the back button remains fully functional. ‚öñÔ∏è<br><br>

  <div style="margin-top:14px;">
    Still here? Good. Press Enter.
  </div>

  <small style="display:block; margin-top:18px; opacity:0.6; line-height:1.35;">
    Legal summary (serious tone): By pressing Enter, you consent to the collection and processing of technical and usage data (including IP address, device/browser headers, coarse geo, pages viewed, clicks, timestamps, referrer, and campaign parameters if present) for site functionality, security, analytics, and attribution. Data may be stored in our database and accessed by service providers solely to operate this site. We do not sell personal data. Retention is limited to what is reasonably necessary for operations and analysis. If you do not agree, do not enter the site.
  </small>
</p>

      <button class="close-disclaimer-btn" onclick="hideDisclaimer()">Close</button>
    </div>
  </div>

<script>
  // Simple, transparent event logging without exposing secrets client-side.
  // Server-side /api endpoints should write to Supabase using service role keys.

  function getOrCreateVisitorId() {
    const key = "visitor_id";
    let id = localStorage.getItem(key);
    if (!id) {
      id = (crypto?.randomUUID?.() || ("v_" + Math.random().toString(16).slice(2) + Date.now().toString(16)));
      localStorage.setItem(key, id);
    }
    return id;
  }

  function loadConsent() {
    return { analytics: true, marketing: true, version: "v1" };
  }

  function saveConsent() {
    localStorage.setItem("consent_v1", JSON.stringify({
      analytics: true,
      marketing: true,
      updatedAt: new Date().toISOString(),
      version: "v1"
    }));
  }

  function getUtmParams() {
    const params = new URLSearchParams(window.location.search);
    const keys = ["utm_source", "utm_medium", "utm_campaign", "utm_content", "utm_term"];
    const utm = {};
    for (const k of keys) {
      const v = params.get(k);
      if (v) utm[k] = v;
    }
    return Object.keys(utm).length ? utm : null;
  }

  async function postEvent(payload) {
    try {
      if (navigator.sendBeacon) {
        const blob = new Blob([JSON.stringify(payload)], { type: "application/json" });
        navigator.sendBeacon("/api/event", blob);
        return;
      }
    } catch (e) {
      // fall through
    }

    try {
      await fetch("/api/event", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
        keepalive: true,
      });
    } catch (e) {
      // ignore
    }
  }

  function buildBasePayload() {
    const consent = loadConsent();
    return {
      visitor_id: getOrCreateVisitorId(),
      path: window.location.pathname,
      referrer: document.referrer || null,
      ts: new Date().toISOString(),
      consent_version: "v1",
      consent_analytics: Boolean(consent.analytics),
      consent_marketing: Boolean(consent.marketing),
      // Client-visible device hints (non-identifying on their own)
      tz: Intl.DateTimeFormat().resolvedOptions().timeZone || null,
      locale: navigator.language || null,
      viewport_w: window.innerWidth || null,
      viewport_h: window.innerHeight || null,
      screen_w: window.screen?.width || null,
      screen_h: window.screen?.height || null,
      dpr: window.devicePixelRatio || null,
      color_scheme: (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) ? "dark" : "light",
      utm: getUtmParams(),
    };
  }

  async function logEnterEvent() {
    const payload = {
      ...buildBasePayload(),
      event: "enter",
      event_type: "navigation",
    };
    postEvent(payload);
  }

  function shouldTrackClicks() {
    return true; // tracking is mandatory after Enter
  }

  function describeElement(el) {
    if (!el) return {};
    const tag = el.tagName ? el.tagName.toLowerCase() : null;
    const id = el.id || null;
    const classes = el.className ? String(el.className).trim() : null;
    const text = (el.innerText || el.textContent || "").trim().slice(0, 120) || null;
    const href = el.getAttribute && el.getAttribute("href") ? el.getAttribute("href") : null;
    const name = el.getAttribute && el.getAttribute("name") ? el.getAttribute("name") : null;
    const type = el.getAttribute && el.getAttribute("type") ? el.getAttribute("type") : null;
    return { tag, id, classes, text, href, name, type };
  }

  function initClickTracking() {
    document.addEventListener("click", (e) => {
      if (!shouldTrackClicks()) return;

      const target = e.target && e.target.closest ? e.target.closest("button, a, input[type='button'], input[type='submit']") : null;
      if (!target) return;

      const payload = {
        ...buildBasePayload(),
        event: "click",
        event_type: "interaction",
        element: describeElement(target),
      };

      postEvent(payload);
    }, { passive: true });
  }

  function showDisclaimer(autoEnter) {
    if (autoEnter) {
      // Mandatory consent by action (Enter)
      saveConsent();
      logEnterEvent();
      window.location.href = "/home/";
      return;
    }

    document.getElementById("welcomeBox").classList.add("shift-up");
    document.getElementById("disclaimerOverlay").classList.add("show");
    document.getElementById("disclaimerBox").classList.add("show");

    // Ensure consent checkboxes are populated when the disclaimer opens
    // initConsentUI(); // removed as per instructions
  }

  function hideDisclaimer() {
    document.getElementById("welcomeBox").classList.remove("shift-up");
    document.getElementById("disclaimerOverlay").classList.remove("show");
    document.getElementById("disclaimerBox").classList.remove("show");
  }

  // Optional: allow keyboard Enter to trigger the same flow
  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      const overlayShown = document.getElementById("disclaimerOverlay").classList.contains("show");
      if (overlayShown) {
        // If the disclaimer is open, Enter means proceed
        showDisclaimer(true);
      }
    }
  });

  // Initialize click tracking globally for this page
  initClickTracking();
</script>

</body>
</html>